From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Yive <6853318+Yive@users.noreply.github.com>
Date: Wed, 19 Jul 2023 23:46:51 -0700
Subject: [PATCH] Toggle for allay listening for game events

Improves the performance drastically with large clusters of allays.
115ms -> 25ms per tick with 1,000 allays.

This setting will break the vibration functionality for allays.

diff --git a/src/main/java/dev/yive/pluto/PlutoConfig.java b/src/main/java/dev/yive/pluto/PlutoConfig.java
index b7c8ac1b202fec9a12b338f54eafd64e1833cc09..304a794fec9f97ad8019d43f29be727a7e621c44 100644
--- a/src/main/java/dev/yive/pluto/PlutoConfig.java
+++ b/src/main/java/dev/yive/pluto/PlutoConfig.java
@@ -247,5 +247,10 @@ public class PlutoConfig {
         private void disableDropperInventoryMoveEvent() {
             disableDropperInventoryMoveEvent = getBoolean("blocks.dropper.disable-move-event", disableDropperInventoryMoveEvent);
         }
+
+        public boolean disableAllayGameEventListening = false;
+        private void disableAllayGameEventListening() {
+            disableAllayGameEventListening = getBoolean("entities.allay.disable-game-event-listener", disableAllayGameEventListening);
+        }
     }
 }
diff --git a/src/main/java/net/minecraft/world/entity/animal/allay/Allay.java b/src/main/java/net/minecraft/world/entity/animal/allay/Allay.java
index 1a0eee3b766a5ce5623c32ed9c023a0f80db1d1a..59bf8f23838edf8f280bba63217e950bad4fe18d 100644
--- a/src/main/java/net/minecraft/world/entity/animal/allay/Allay.java
+++ b/src/main/java/net/minecraft/world/entity/animal/allay/Allay.java
@@ -421,6 +421,7 @@ public class Allay extends PathfinderMob implements InventoryCarrier, VibrationS
     @Override
     public void updateDynamicGameEventListener(BiConsumer<DynamicGameEventListener<?>, ServerLevel> callback) {
         Level world = this.level();
+        if (world.plutoConfig().disableAllayGameEventListening) return; // Pluto - Toggle for allay listening for game events
 
         if (world instanceof ServerLevel) {
             ServerLevel worldserver = (ServerLevel) world;
